<!DOCTYPE html>
<html>

<head>
    <title>Import Tests</title>
</head>
<meta charset="utf-8">
<body>

    <form>
        <input type="file" id="roomsFile">
        <input type="button" value="Import Room(s)" onclick="readRoomsFromFile()">
    </form>

    <br/>
    
    <form>
        <input type="file" id="riddlesFile">
        <input type="button" value="Import Riddle(s)" onclick="readRiddlesFromFile()">
    </form>

</body>

<script>
    // TODO: Add check for JSON file in final script
    function readRoomsFromFile() {
        var file = document.getElementById("roomsFile").files[0];
        var reader = new FileReader();

        reader.onload = function (e) {
            var fileContents = e.target.result;
            importRooms(fileContents);
        };

        reader.readAsText(file);
    }

    function importRooms(fileContents) {
        var url = "../src/controllers/escapeRoomController.php";

        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=importFromJson&jsonContents=" + encodeURIComponent(fileContents)
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function readRiddlesFromFile() {
        var file = document.getElementById("riddlesFile").files[0];
        var reader = new FileReader();

        reader.onload = function (e) {
            var fileContents = e.target.result;
            importRiddles(fileContents);
        };

        reader.readAsText(file);
    }

    function importRiddles(fileContents) {
        var url = "../src/controllers/riddleController.php";

        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=importFromJson&jsonContents=" + encodeURIComponent(fileContents)
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }
</script>

</html>