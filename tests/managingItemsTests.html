<!DOCTYPE html>
<html>

<head>
    <title>Managing Items Tests</title>
</head>
<meta charset="utf-8">

<body>

    <button type="button" onclick="testGetRoomDetails(false)">Test Get Room Details</button>
    <br />
    <button type="button" onclick="testGetRoomDetails(true)">Test Get Room Details Export</button>
    <br />
    <button type="button" onclick="testAddRoom()">Test Add Room</button>
    <br />
    <button type="button" onclick="testUpdateRoom()">Test Update Room</button>
    <br />
    <button type="button" onclick="testTranslateRoom()">Test Translate Room</button>
    <br />
    <button type="button" onclick="testDeleteRoom()">Test Delete Room</button>
    <br />
    <br />
    <button type="button" onclick="testGetRiddleDetails(false)">Test Get Riddle Details</button>
    <br />
    <button type="button" onclick="testGetRiddleDetails(true)">Test Get Riddle Details Export</button>
    <br />
    <button type="button" onclick="testAddRiddle()">Test Add Riddle</button>
    <br />
    <button type="button" onclick="testUpdateRiddle()">Test Update Riddle</button>
    <br />
    <button type="button" onclick="testTranslateRiddle()">Test Translate Riddle</button>
    <br />
    <button type="button" onclick="testDeleteRiddle()">Test Delete Riddle</button>
    <br />
    <button type="button" onclick="testAddRoomRiddle()">Test Add RoomRiddle</button>
    <br />
    <button type="button" onclick="testDeleteRoomRiddle()">Test Delete RoomRiddle</button>
</body>

<script>
    function testGetRoomDetails(exportParam = false) {
        var url = "../src/controllers/escapeRoomController.php?";

        if (exportParam) {
            fetch(url + new URLSearchParams({ action: "getRoomDetails", id: 1, language: "en", export: exportParam }))
                .then(function (response) {
                    if (response.ok) {
                        return response.blob();
                    }
                    throw new Error("Error: " + response.status);
                })
                .then(function (blob) {
                    var temp = document.createElement('a');
                    temp.href = URL.createObjectURL(blob);
                    temp.download = 'room-details-export.json';
                    temp.click();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
        else {
            fetch(url + new URLSearchParams({ action: "getRoomDetails", id: 1, language: "en" }))
                .then(function (response) {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error("Error: " + response.status);
                    }
                })
                .then(function (data) {
                    console.log(data);
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
    }

    function testAddRoom() {
        var url = "../src/controllers/escapeRoomController.php?";

        var roomObject = JSON.stringify({
            language: "en",
            name: "Very new escape room",
            difficulty: 3,
            timeLimit: 45,
            minPlayers: 1,
            maxPlayers: 1,
            image: "https://escapetheroom.com/wp-content/uploads/2018/11/escape-the-room-head.jpg"            
        });

        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=addRoom&roomJson=" + encodeURIComponent(roomObject)
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function testUpdateRoom() {
        var url = "../src/controllers/escapeRoomController.php?";

        var roomObject = JSON.stringify({
            id: 1,
            language: "en",
            name: "Sample escape room",
            difficulty: 4,
            timeLimit: 60,
            minPlayers: 1,
            maxPlayers: 2,
            image: "https://escapetheroom.com/wp-content/uploads/2018/11/escape-the-room-head.jpg"
        });

        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=updateRoom&roomJson=" + encodeURIComponent(roomObject)
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function testTranslateRoom() {
        var url = "../src/controllers/escapeRoomController.php?";

        var roomTranslation = JSON.stringify({
            id: 1,
            language: "fr",
            name: "Exemple de salle d'évasion"
        });

        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=translateRoom&roomJson=" + encodeURIComponent(roomTranslation)
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function testDeleteRoom() {
        var url = "../src/controllers/escapeRoomController.php?";
        var roomToDelete = 2;
        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=deleteRoom&id=" + roomToDelete
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }
</script>

<script>
    function testGetRiddleDetails(exportParam = false) {
        var url = "../src/controllers/riddleController.php?";

        if (exportParam) {
            fetch(url + new URLSearchParams({ action: "getRiddleDetails", id: 1, language: "en", export: exportParam }))
                .then(function (response) {
                    if (response.ok) {
                        return response.blob();
                    }
                    throw new Error("Error: " + response.status);
                })
                .then(function (blob) {
                    var temp = document.createElement('a');
                    temp.href = URL.createObjectURL(blob);
                    temp.download = 'riddle-details-export.json';
                    temp.click();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
        else {
            fetch(url + new URLSearchParams({ action: "getRiddleDetails", id: 1, language: "en" }))
                .then(function (response) {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error("Error: " + response.status);
                    }
                })
                .then(function (data) {
                    console.log(data);
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
    }

    function testAddRiddle() {
        var url = "../src/controllers/riddleController.php?";

        var riddleObject = JSON.stringify({
            type: "rebus",
            language: "en",
            task: "New task",
            solution: "New solution",
            image: "https://teambuilding.com/wp-content/uploads/2020/11/escape-room-puzzle-4.jpg"            
        });

        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=addRiddle&riddleJson=" + encodeURIComponent(riddleObject)
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function testUpdateRiddle() {
        var url = "../src/controllers/riddleController.php?";

        var riddleObject = JSON.stringify({
            id: 3,
            type: "colors",
            language: "en",
            task: "New riddle task",
            solution: "New riddle solution",
            image: "https://teambuilding.com/wp-content/uploads/2020/11/escape-room-puzzle-4.jpg" 
        });

        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=updateRiddle&riddleJson=" + encodeURIComponent(riddleObject)
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function testTranslateRiddle() {
        var url = "../src/controllers/riddleController.php?";

        var riddleTranslation = JSON.stringify({
            id: 1,
            language: "fr",
            task: "Tâche factice 1",
            solution: "Solution factice 1"
        });

        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=translateRiddle&riddleJson=" + encodeURIComponent(riddleTranslation)
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function testDeleteRiddle() {
        var url = "../src/controllers/riddleController.php?";
        var riddleToDelete = 3;
        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=deleteRiddle&id=" + riddleToDelete
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function testAddRoomRiddle() {
        var url = "../src/controllers/riddleController.php?";
        var roomId = 1;
        var riddleId = 5;
        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=addRoomRiddle&roomId=" + roomId + "&riddleId=" + riddleId
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function testDeleteRoomRiddle() {
        var url = "../src/controllers/riddleController.php?";
        var roomId = 1;
        var riddleId = 4;
        var request = {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: "action=deleteRoomRiddle&roomId=" + roomId + "&riddleId=" + riddleId
        };

        fetch(url, request)
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error("Error: " + response.status);
                }
            })
            .then(function (data) {
                console.log(data);
            })
            .catch(function (error) {
                console.log(error);
            });
    }
</script>

</html>